
<div class="alert-box processing" ng-if="isProcessing">
  One or more Feeds are processing. Please <a href="/">Refresh</a> this page for an update. <small>(Page will automatically refresh after a minute.)</small>
</div>

<div class="data-module data-module-full">
<h2>Active Feeds</h2>

<span ng-if="!feeds" class="is-loading"></span>
<table id="feedsTable" ng-table="feedTableParams" template-pagination="feedsPagination" class="associations">
  <tr id="feedIndex{{$index}}" ng-repeat="feed in $data">
    <td id="date{{$index}}" data-title="'Date'" sortable="'date'" ><a ng-class="{'disabled-row': !feed.complete && !feed.failed, 'disabled-row-failed': !feed.complete && feed.failed}" href="{{feed.self}}" data-title-text="Date"><span class="td-text">{{feed.date}}</span></a>
    </td>
    <td id="state{{$index}}" data-title="'State'" sortable="'state'"><a ng-class="{'disabled-row': !feed.complete && !feed.failed, 'disabled-row-failed': !feed.complete && feed.failed}" href="{{feed.self}}" data-title-text="State"><span class="td-text">{{feed.state}}</span></a>
    </td>
    <td id="type{{$index}}" data-title="'Type'" sortable="'type'"><a ng-class="{'disabled-row': !feed.complete && !feed.failed, 'disabled-row-failed': !feed.complete && feed.failed}" href="{{feed.self}}" data-title-text="Type"><span class="td-text">{{feed.type}}</span></a>
    </td>
    <td id="status{{$index}}" data-title="'Status'" sortable="'status'"><a ng-class="{'disabled-row': !feed.complete && !feed.failed, 'disabled-row-failed': !feed.complete && feed.failed}" href="{{feed.self}}" data-title-text="Status"><span class="is-loading-small" ng-show="!feed.complete && !feed.failed"></span><i ng-if="feed.failed" class="fi-prohibited"></i> <span class="td-text">{{feed.status}} <small>{{feed.processingTime}}</small></span></a>
    </td>
    <td data-title="'Due'" sortable="'due'"><a ng-class="{'disabled-row': !feed.complete && !feed.failed, 'disabled-row-failed': !feed.complete && feed.failed}" href="{{feed.self}}" data-title-text="Due"><span class="td-text">{{feed.due_in}}</span></a></td>
    <td data-title="'Loaded On'" sortable="'date_loaded'"><a ng-class="{'disabled-row': !feed.complete && !feed.failed, 'disabled-row-failed': !feed.complete && feed.failed}" href="{{feed.self}}" data-title-text="Loaded On"><span class="td-text">{{feed.date_loaded_formatted}}</span></a></td>
  </tr>
  <tr ng-if="feeds.length === 0">
    <td colspan="6"><p style="padding: 1em;">No Feeds Found</p></td>
  </tr>
</table>

<script type="text/ng-template" id="feedsPagination">
  <ul class="pagination ng-cloak">
    <li ng-repeat="page in pages"
        ng-class="{'ng-hide': page.type == 'prev' || page.type == 'next'}">
      <a id="feedsPage{{$index}}" ng-class="{'is-active': page.number == tableParams.page()}"
         ng-click="feedTableParams.page(page.number)" href="">{{page.number}}</a>
    </li>
  </ul>
</script>
</div>

<div ng-show="feedQueue.length > 0" class="data-module data-module-full">
  <h2 class="secondary">Feeds in Queue For Processing <a style="font-weight: bold; color: orange; font-size: 13px" href="/">(Click to Refresh List)</a></h2>

  <span ng-if="!feeds" class="is-loading"></span>
  <table>
    <thead>
    <tr>
      <th width="30%">File Name</th>
      <th>S3 Bucket Name</th>
    </tr>
    </thead>
    <tr id="feedQueue{{$index}}" ng-repeat="feedQ in feedQueue">
      <td id="feedQeueue_filename{{$index}}">
        {{feedQ.filename}}
      </td>
      <td id="feedQeueue_s3bucket{{$index}}">
        {{feedQ.s3Bucket}}
      </td>
    </tr>
  </table>

</div>



<!-- Remove below for production -->
<small>
  <b>Please Note:</b> This is a temporary form to facilitate the starting of the feed processing.<br>
  (If running locally, place feed file under the app's <b>/upload</b> folder)
</small>
<div style="border: 1px solid #cecece; padding: 5px; max-width: 500px">
  <small>
    <form name="feedForm" action="/services/feeds" method="post" onsubmit="  if(this.elements['filenames'].value.trim().length==0){ alert('Filename(s) field is required.'); this.elements['filenames'].focus(); return false; } else { this.elements['submit'].disabled = true; document.forms[0].elements['submit'].style.cssText='background-color: gray';  this.elements['submit'].value='Please Wait...'; return true; } ">
      <b>Enter one or more Filenames, separated by a new line:</b> <textarea onchange="this.value = this.value.trim()" style="display: block; max-width: 350px; height: 200px" type="text" name="filenames"></textarea>
      <b>Enter the S3 Bucket Name (if any):</b> <input onchange="this.value = this.value.trim()" style="max-width: 350px;" type="text" name="s3bucket">
      <input name="submit" type="submit" value="Submit">
    </form>
  </small>
</div>